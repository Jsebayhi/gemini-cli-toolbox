# Project Context: Gemini CLI Toolbox

This document provides high-level operational context for AI agents working on the repository as a whole.

## 1. Project Overview
A modular "Gemini CLI Toolbox" repository containing multiple self-contained Dockerized CLI tools. Each tool resides in `images/<tool-name>` and manages its own lifecycle.

## 2. Repository Structure

| Directory | Purpose |
| :--- | :--- |
| `bin/` | **User Interface.** Wrapper scripts (`gemini-toolbox`) that users invoke directly. |
| `images/` | **Components.** Source code for each Docker image. |
| `images/gemini-cli/` | **Gemini CLI.** [See Component Context](images/gemini-cli/GEMINI.md) |
| `Makefile` | **Orchestrator.** Master makefile for global build tasks. |

## 3. Global Workflows

### Adding a New Tool
1. Create `images/<new-tool>/`.
2. Add `Dockerfile`, `Makefile`, and `GEMINI.md` specific to that tool.
3. Add a wrapper script in `bin/`.
4. Register the tool in the root `README.md`.

### Global Build
```bash
make build
```

## 4. Core Mandates

### Documentation is Code
*   **Mandate:** You must strictly maintain all documentation (`README.md`, `GEMINI.md`, `adr/*`) in sync with code changes.
*   **Trigger:** Any time you rename files, change architecture, modify workflows, or discover new gotchas, you **MUST** update the corresponding documentation in the same turn.
*   **User-Facing Rule:** If you add a new feature (e.g., a flag, a command, a capability) or change behavior, you **MUST** update the root `README.md` to reflect this immediately. Do not leave features undocumented.
*   **Why:** This project relies on the "Golden Artifact" pattern where the documentation is the source of truth for future sessions.

### Context Management
*   **Rule:** When working on a specific tool, **load its specific `GEMINI.md`**.
*   **Why:** The root context is generic; the component context contains the critical "gotchas" for that specific image.

## 5. Naming Strategy

### Consistency Mandate
To ensure reliable discovery (e.g., via Gemini Hub) and ease of debugging, all tools must adhere to a **strict 1:1 naming scheme**. The Docker Container Name and the Tailscale Hostname must be identical.

| Context | Pattern | Example |
| :--- | :--- | :--- |
| **Docker Container** | `gem-{PROJECT}-{TYPE}-{ID}` | `gem-my-app-geminicli-a1b2` |
| **Tailscale Hostname** | `gem-{PROJECT}-{TYPE}-{ID}` | `gem-my-app-geminicli-a1b2` |

### Components
*   **Prefix `gem-`**: Mandatory namespace to avoid collisions with host resources or other VPN nodes.
*   **`PROJECT`**: The lowercased, sanitized basename of the current workspace directory (non-alphanumeric chars replaced by hyphens).
*   **`TYPE`**: The session mode. Standard values: `geminicli` (Chat), `bash` (Shell). **Must NOT contain hyphens** to ensure robust parsing.
*   **`ID`**: A unique suffix (e.g., first 8 chars of UUID) generated by the toolbox script.

### Parsing Logic
Discovery tools (like `gemini-hub`) rely on this structure.
*   **Source of Truth:** The `gemini-toolbox` script generates the `GEMINI_SESSION_ID` and passes it to the container. The container **must** use this ID as-is.
*   **Parsing:** Split by `-`.
    *   Prefix: Index 0 (`gem`)
    *   Suffix: Index -1 (`ID`)
    *   Type: Index -2 (`TYPE`)
    *   Project: Join `1` to `-2` (`PROJECT`)

## 6. Configuration Profiles
*   **Concept:** Users can maintain multiple configuration directories (profiles) for different contexts (e.g., Work, Personal).
*   **Location:** Default is `~/.gemini`. Additional profiles are typically in `~/.gemini-profiles/`.
*   **Selection:** Use `gemini-toolbox --config <path>` to select a profile.
*   **Customization:** A profile can define persistent runtime arguments (volumes, flags) by placing a file named `extra-args` in its root. See [ADR-0010](images/gemini-cli/adr/0010-configuration-profiles-and-extra-args.md).

## 7. Known Peculiarities & Gotchas
--- End of Context from: GEMINI.md ---



# 3. Naming Consistency and Session Identity

Date: 2026-01-23

## Status

Accepted

## Context

Initially, the Docker container name and the Tailscale hostname were generated independently:
*   Docker: `gemini-cli-toolbox-<UUID>` (generated by script)
*   Tailscale: `gem-{PROJECT}-{TYPE}-{UUID}` (generated by entrypoint)

This led to several issues:
1.  **Drift:** The container name didn't match the network name, confusing users during debugging (`docker logs gemini-cli...` vs checking `gem-myproject...` on VPN).
2.  **Parsing Fragility:** The entrypoint tried to reconstruct the project name from `pwd` and the type from environment variables, leading to inconsistencies if environments differed.
3.  **Hyphen Ambiguity:** Project names with hyphens (e.g., `my-app`) combined with hyphenated types (`gemini-cli`) made parsing the hostname `gem-my-app-gemini-cli-a1b2` impossible to reverse-engineer reliably in the Hub.

## Decision

We decided to enforce a **Strict 1:1 Naming Strategy** driven by the Toolbox script.

### 1. Single Source of Truth
The `gemini-toolbox` script is the sole authority on Session Identity.
*   It calculates a `GEMINI_SESSION_ID` string.
*   Format: `gem-{PROJECT}-{TYPE}-{ID}`.
*   It passes this ID to the container via the `GEMINI_SESSION_ID` environment variable.

### 2. Universal Prefix (`gem-`)
We apply the `gem-` prefix to **both** the Docker container and the Tailscale hostname.
*   **Why:** Consistency. If a user sees `gem-foo` in the Hub, they can type `docker stop gem-foo` locally.
*   **Namespace:** It clearly separates ephemeral Toolbox containers from long-running host containers.

### 3. Hyphen-Free Types
We renamed the default session type from `gemini-cli` to `geminicli`.
*   **Why:** To ensure the "Type" segment of the hostname never contains a hyphen.
*   **Parsing Benefit:** This allows us to robustly parse the hostname from the *right side* (Suffix -> Type -> Project), correctly handling project names with arbitrary hyphens.

## Consequences

### Positive
*   **Debuggability:** `docker ps` matches `tailscale status`.
*   **Robustness:** Parsing logic in the Hub is deterministic and simpler.
*   **Clarity:** Users always know which container corresponds to which remote session.

### Negative
*   **Verbosity:** Local docker names are slightly longer (`gem-my-project-geminicli-a1b2` vs `my-project-a1b2`).
